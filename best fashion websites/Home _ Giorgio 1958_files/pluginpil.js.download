(function($){
    function T(d){
        var self = this;
        this.dom = d;
        
        this.open=function(sel){
            self.removeSelection();
            sel.addClass("active");
            var id = sel.attr('href');
            jQuery('#'+id).addClass('active');
        };
        
        this.removeSelection = function(){
            this.dom.find('.tabhead a').removeClass('active');
            this.dom.find('.tabcontent .tc').removeClass('active');
            return false;
        };
        
        this.dom.find('.tabhead a').on("click",function(){
            var sel = jQuery(this);
            self.open(sel);
            
            return false;
        });
        this.dom.find('.tabhead a').on("mouseenter",function(){
           var sel = jQuery(this);
           if(sel.hasClass('activer')) return ;
           self.open(sel);
        });
        
    }
    
    
     $.fn.extend({
        ptab: function () {
            jQuery(this).each(function () {
               new T(jQuery(this));
            });
        }
    });
})(jQuery);





/**
 * Gestione Popup
 *  @author Gabriele Pagnotta <pil associati srl>
 * opt={
 * 'class':'classe popuop'
 * 'html':'contenuto'
 * };
 */
(function () {
    var popup = null;
    /**
     * Crea html Popup
     */
    function createPopup(cl, loading) {
        if (popup == null) {
            var html = "<div id='popup'><div class='bg'></div>";
            html += "<div class='wrpcontent " + cl + "'><a class='close fa fa-remove' href='#'>&nbsp;</a><div class='content'></div>";
            html += "</div></div>";
            jQuery('body').append(html);
            popup = jQuery('#popup');
        }
        else {
            popup.find('.wrpcontent').attr('class', 'wrpcontent ' + cl);
        }

        if (loading === true) {
            popup.find('.content').addClass('loading');
            popup.find('.content').html('<div class="loader"><span class="fa fa-spinner fa-spin"></div></div>');
           
        }
        popup.find('.close').click(function () {
            Popup.closePopup();
            return false;
        });

    }
    this.Popup = function () {
    };
    /**
     * 
     * Apre POPUP LOADING
     */
    this.Popup.loading = function () {
        this.closePopup();

        jQuery('body').trigger("pil_openpopup");
        createPopup("popuploading", true);
    };
    /**
     * Crea popup immagine
     */
    this.Popup.openImage = function (url) {
        this.closePopup();

        createPopup('zoomimg empty', true);
        var cnt = jQuery('#popup .zoomimg');
        var img = new Image();
        jQuery(img).load(function () {
            if (popup.size() == 0)
                return;

            var w = img.width;
            var h = img.height;
            var wS = popup.outerWidth(true);
            var hS = popup.outerHeight(true);
            var wD = parseInt(wS * 0.8);
            var hD = parseInt(hS * 0.8);
            // Calcolo dimensione immagine
            var wi = Math.min(w, wD);
            var hi = wi / w * h;
            if (hi > hD) {
                hi = hD;
                wi = hi / h * w;
            }
            var h = "<img src='" + url + "' width='" + wi + "' height='" + hi + "' />";
            Popup.removeLoading();
            cnt.find('.content').html(h);
            cnt.removeClass('empty');
            cnt.css({'width': wi + "px", 'height': hi + "px", 'top': ((hS - hi) / 2) + "px", 'left': ((wS - wi) / 2) + "px"});
        });
        img.src = url;
    };

    this.Popup.removeLoading = function () {
        if (popup != null) {
            popup.find('.loader').trigger("bloader_stop");
            popup.find('.content').removeClass('loading');
        }
    };

    this.Popup.openUrl = function (url, cl) {
        createPopup(cl, true);
        jQuery.ajax({
            'url': url,
            'method': 'GET',
            'success': function (html) {
                Popup.removeLoading();
                popup.find('.content').html(html);
            },
            'error': function () {
                Pil.closePopup();
            }
        });
    };
    this.Popup.open = function (opt) {
        this.closePopup();
        jQuery('body').trigger("pil_openpopup");
        createPopup((opt.class === undefined ? "" : opt.class), false);
        popup.find('.content').html(opt.html);
        if (typeof opt.onshow === "function") {
            opt.onshow();
        }
    };
    this.Popup.closePopup = function () {
        if (popup == null)
            return;
        jQuery('body').trigger("pil_closepopup");
        this.removeLoading();
        popup.remove();
        popup = null;
    };

    this.Popup.message = function (text) {
        this.open({
            'html': '<p>' + text + "</p>",
            'class': 'message'
        });
    };
    this.Popup.error = function (text) {
        this.open({
            'html': '<p>' + text + "</p>",
            'class': 'message syserr'
        });
    };
})();

function CImg(dom){
    
    var img = dom.find('img');
    var pr = parseFloat(img.attr('p'));
    var sc = parseFloat(img.attr('s'));
    
    var self = this;
    this.resize =function(){
        if(Pil.isMobile()){
            dom.attr({
                "style":""
            });
            img.attr({
                "style":""
            });
            return;
        }
        
        var w = jQuery("#pagecontent").width();
        var h = jQuery("#pagecontent").height();
        
        dom.css({
           
            'height':h+"px"
        });
        
        var hi = h*sc;
        var wi = hi*pr;
        img.css({
            'margin-left':((w-wi)/2)+"px",
            'margin-top':((h-hi)/2)+"px",
            'width':(wi)+"px",
            'height':(hi)+"px",
            'display':'block'
        });
        
        
    };
    
    self.resize();
    jQuery(window).resize(function(){
        self.resize();
    });
}




jQuery(document).ready(function(){
    jQuery('.fullpagetitle').each(function(){
        new CImg(jQuery(this));
    });
    
   if(jQuery('#scrollavv').size()>0){
       jQuery('#pagecontent').scroll(function(){
           jQuery('#scrollavv').remove();
       });
   }
   
   
});